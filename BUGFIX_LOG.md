# ğŸ› Bugä¿®å¤è¯´æ˜

## v2.1.1 - ä¿®å¤çº¿ç¨‹å®‰å…¨é—®é¢˜ (2025-10-02)

### é—®é¢˜æè¿°
```
âŒ æˆªå›¾å¤±è´¥: '_thread._local' object has no attribute 'srcdc'
```

### æ ¹æœ¬åŸå› 
mssåº“åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚åœ¨`GameVisionDetector.__init__`ä¸­åˆ›å»ºçš„`self.sct = mss.mss()`å®ä¾‹åœ¨å¤šçº¿ç¨‹è°ƒç”¨æ—¶ä¼šå¯¼è‡´å†²çªã€‚

### è§£å†³æ–¹æ¡ˆ
ä¿®æ”¹ `services/game_vision.py`ï¼š

**ä¿®æ”¹å‰ï¼š**
```python
def __init__(self, model_path=None):
    self.sct = mss.mss()  # âŒ åœ¨åˆå§‹åŒ–æ—¶åˆ›å»ºï¼Œçº¿ç¨‹ä¸å®‰å…¨
    # ...

def capture_screen(self, region=None):
    screenshot = self.sct.grab(monitor)  # âŒ å¤šçº¿ç¨‹å†²çª
```

**ä¿®æ”¹åï¼š**
```python
def __init__(self, model_path=None):
    # âœ… ä¸åœ¨åˆå§‹åŒ–æ—¶åˆ›å»ºmsså®ä¾‹
    # ...

def capture_screen(self, region=None):
    # âœ… æ¯æ¬¡è°ƒç”¨æ—¶åˆ›å»ºæ–°å®ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    with mss.mss() as sct:
        screenshot = sct.grab(monitor)
```

### ä¿®æ”¹è¯¦æƒ…
1. ç§»é™¤ `self.sct = mss.mss()` å®ä¾‹å˜é‡
2. åœ¨ `capture_screen()` æ–¹æ³•ä¸­ä½¿ç”¨ `with mss.mss() as sct:` ä¸Šä¸‹æ–‡ç®¡ç†å™¨
3. æ¯æ¬¡æˆªå›¾æ—¶åˆ›å»ºç‹¬ç«‹çš„msså®ä¾‹ï¼Œé¿å…çº¿ç¨‹å†²çª

### å½±å“èŒƒå›´
- âœ… ä¿®å¤äº†åå°æ£€æµ‹çº¿ç¨‹çš„æˆªå›¾å´©æºƒé—®é¢˜
- âœ… ä¿®å¤äº†æ‰‹åŠ¨æˆªå›¾åŠŸèƒ½çš„é”™è¯¯
- âœ… ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§

### æ€§èƒ½å½±å“
- æ¯æ¬¡æˆªå›¾åˆ›å»ºæ–°å®ä¾‹ä¼šæœ‰è½»å¾®æ€§èƒ½å¼€é”€ï¼ˆ<5msï¼‰
- ç›¸æ¯”å´©æºƒé—®é¢˜ï¼Œæ€§èƒ½æŸå¤±å¯ä»¥æ¥å—
- mssåº“çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¼šè‡ªåŠ¨æ¸…ç†èµ„æº

### æµ‹è¯•éªŒè¯
```bash
# è¿è¡Œæµ‹è¯•
python test_cv_detection.py

# é¢„æœŸç»“æœ
âœ… æˆªå›¾æˆåŠŸ
   åˆ†è¾¨ç‡: 2560x1440
   é€šé“æ•°: 3
   æ•°æ®ç±»å‹: uint8
```

### ç›¸å…³æ–‡ä»¶
- `services/game_vision.py` - æ ¸å¿ƒä¿®å¤
- `services/vision_service.py` - è°ƒç”¨æˆªå›¾çš„æœåŠ¡ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

### é™„åŠ è¯´æ˜
è¿™æ˜¯mssåº“çš„å·²çŸ¥é—®é¢˜ï¼Œå‚è€ƒï¼š
- https://github.com/BoboTiG/python-mss/issues/203
- æ¨èä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨é¿å…çº¿ç¨‹é—®é¢˜

---

**ä¿®å¤æ—¥æœŸ**: 2025-10-02  
**ç‰ˆæœ¬**: v2.1.1
